<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Double-Odd to Jacobi Quartics - Double-Odd Elliptic Curves</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="front.html"><strong aria-hidden="true">1.</strong> Double-Odd Elliptic Curves</a></li><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">2.</strong> A Geometrical Introduction</a></li><li class="chapter-item expanded "><a href="jacobi.html" class="active"><strong aria-hidden="true">3.</strong> Double-Odd to Jacobi Quartics</a></li><li class="chapter-item expanded "><a href="shortsig.html"><strong aria-hidden="true">4.</strong> Short Signatures</a></li><li class="chapter-item expanded "><a href="formulas.html"><strong aria-hidden="true">5.</strong> Formulas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="formulas-xy.html"><strong aria-hidden="true">5.1.</strong> Affine (x, y) Coordinates</a></li><li class="chapter-item expanded "><a href="formulas-xw.html"><strong aria-hidden="true">5.2.</strong> Affine and Jacobian (x, w) Coordinates</a></li><li class="chapter-item expanded "><a href="formulas-xu.html"><strong aria-hidden="true">5.3.</strong> Affine and fractional (x, u) Coordinates</a></li><li class="chapter-item expanded "><a href="formulas-ladder.html"><strong aria-hidden="true">5.4.</strong> x-only Ladders</a></li><li class="chapter-item expanded "><a href="formulas-eu.html"><strong aria-hidden="true">5.5.</strong> Affine and extended (e, u) Coordinates</a></li></ol></li><li class="chapter-item expanded "><a href="curves.html"><strong aria-hidden="true">6.</strong> Curve Choices</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="params-do255e.html"><strong aria-hidden="true">6.1.</strong> do255e / jq255e</a></li><li class="chapter-item expanded "><a href="params-do255s.html"><strong aria-hidden="true">6.2.</strong> do255s / jq255s</a></li></ol></li><li class="chapter-item expanded "><a href="benchmarks.html"><strong aria-hidden="true">7.</strong> Benchmarks</a></li><li class="chapter-item expanded "><a href="implementations.html"><strong aria-hidden="true">8.</strong> Implementations</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Double-Odd Elliptic Curves</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style type="text/css">
    .coal img {
        background-color: #E0E0E0;
    }
    .navy img {
        background-color: #E0E0E0;
    }
    .ayu img {
        background-color: #E0E0E0;
    }
</style>
<h1><a class="header" href="#double-odd-curves-as-jacobi-quartics" id="double-odd-curves-as-jacobi-quartics">Double-Odd Curves as Jacobi Quartics</a></h1>
<p>After the initial publication of double-odd curve formulas, it was found
that they can be turned, with a proper change of variable, into another
type of curve equation known as the <em>Jacobi quartic</em>. In this alternate
representation, we can have somewhat more efficient formulas for point
doublings, and we can also support a different encoding format for which
point decoding from bytes is more efficient than with the original
double-odd curves.</p>
<h2><a class="header" href="#change-of-variable" id="change-of-variable">Change of Variable</a></h2>
<p>For a double-odd elliptic curve of equation \(y^2 = x(x^2 + ax + b)\),
we can consider the following change of variables:
\[\begin{eqnarray*}
u &amp;=&amp; \frac{x}{y} \\
e &amp;=&amp; u^2 \left(x - \frac{b}{x}\right)
\end{eqnarray*}\]</p>
<p>The \(u\) coordinate is the inverse of the \(w\) coordinate that we
encountered previously; \(w = y/x\) is the slope of the line from the
point \(N\) of order two, to the point \(P = (x,u)\). The \(u\)
coordinate has the advantage of being naturally extended to a finite
value (\(0\)) for \(N\) itself: the tangent to the curve on \(N\) is
vertical, so its slope is infinite, but the inverse of the slope should
then be zero. Moreover, there is no other point of order 2, so there is
no point distinct from \(N\) where \(w = 0\), which means that
\(u\) is well-defined.</p>
<p>The \(e\) coordinate is also well-defined, since a simple calculation
shows that it is equal to \((x^2 - b)/(x^2 + ax + b)\), and neither
the denominator nor the denominator is ever zero for a double-odd curve.
For \(N\), the \(e\) coordinate is \(-1\). We can even extend the
\((e,u)\) coordinates to the point-at-infinity \(\mathbb{O}\), which
does not have defined \((x,y)\) coordinates, by setting \(e = 1\)
and \(u = 0\) for that point; as will be seen later on, these are the
values that &quot;work well&quot; with the formulas.</p>
<img style="float: left; width: 40%; padding 0.5em; margin: 1.5em;" src="jacobi1.svg" />
<p>The change of variable morphs the curve equation into:
\[\begin{eqnarray*}
e^2 = (a^2-4b)u^4 - 2a u^2 + 1
\end{eqnarray*}\]
which is an equation type known as the Jacobi quartic, and studied by C.
G. J. Jacobi back in the 19th century. This yields a curve shape (when
applied to real numbers) similar to the one shown here. The picture
exhibits some salient features of that curve shape:</p>
<ul>
<li>
<p>The point-at-infinity is no longer &quot;at infinity&quot;; it has defined
coordinates.</p>
</li>
<li>
<p>For a given point \(P = (e,u)\), we easily obtain \(-P = (e,-u)\),
\(P+N = (-e,-u)\), and \(-P+N = (-e,u)\) (this explains why we
choose \((1,0)\) as the coordinates of the point-at-infinity, given
that \(N = (-1,0)\)).</p>
</li>
</ul>
<p>Many formulas for computing point additions on Jacobi quartics have been
discovered over the years; for a good summary, see the paper <a href="https://eprint.iacr.org/2009/312">Jacobi
Quartic Curves Revisited</a> by Hisil,
Wong, Carter and Dawson. Using their <em>extended coordinates</em> (or,
equivalently, the representation <a href="https://hal-lirmm.ccsd.cnrs.fr/lirmm-00145805/document">proposed earlier by
Duquesne</a>, which
is the same system under slightly different notations), we get general
point addition in cost 8M+3S, which is roughly equivalent to the 10M
cost we get with the original double-odd curves in \((x,u)\)
coordinates. We get some improvements on doublings:</p>
<ul>
<li>
<p>A single point doubling is computed in cost 2M+5S, that can be
lowered to 1M+6S on many double-odd curves, in particular the
ones we specify as standard curves (jq255e and jq255s).</p>
</li>
<li>
<p>We can still optimize sequences of doublings, with a per-doubling
cost of 1M+5S (jq255e) or 2M+4S (jq255s); we could already do that
with the original double-odd curves, but the overhead for entering
the sequence is lower (only 1S instead of 3M).</p>
</li>
</ul>
<p>We can thus obtain some performance improvements on computations.</p>
<h2><a class="header" href="#enhanced-point-compression" id="enhanced-point-compression">Enhanced Point Compression</a></h2>
<p>Using \((e,u)\) coordinates yields another performance gain, related
to the encoding (aka compression) of points into bytes.</p>
<p>Double-odd curves have order \(2r\) for some odd integer \(r\); we
of course usually arrange for \(r\) to be prime. We want to work with
a prime order group, such as \(E[r]\) (the points of \(r\)-torsion
on the curve); what we are really using is a <em>quotient group</em>: the
quotient of the curve by the subgroup \(\{\mathbb{O},N\}\). In other
words, a group element is a pair of points \(\{P,P+N\}\), and the
two points \(P\) and \(P+N\) both <em>represent</em> the same group element.</p>
<p>In the original double-odd curves, we always enforce the use of the
representant which is <em>not</em> a point of \(r\)-torsion; we do so, as
explained in the <a href="intro.html">geometrical introduction</a>, so that we avoid
the tricky exceptional cases of the traditional addition law on short
Weierstraß curves. When decoding points from their \(w\) coordinate,
there are two possible matching points on the curve, but only one of
them is a non-\(r\)-torsion point, and we can unambiguously recognize
that point thanks to the fact that the \(x\) coordinate of an
\(r\)-torsion point is a square in the field, while the \(x\)
coordinate of a non-\(r\)-torsion point is a non-square.</p>
<p>This scheme works, but it entails computing a Legendre symbol on top of
the square root which is already needed to get the two candidate points
for a given \(w\). Jacobi quartics give us a better option which
avoids the cost of that Legendre symbol. Indeed, the choice of the
&quot;right&quot; representant was required because the \((x,u)\) formulas are
complete <em>on the group</em> but may miscompute things if given points of
\(r\)-torsion. <em>A contrario</em>, the formulas on double-odd Jacobi
quartics are complete <em>on the whole curve</em>: we do not have to select any
specific representant, both will work properly (the completeness of the
formulas does not apply to <em>all</em> Jacobi quartics, but it applies to
about half of them, including all double-odd Jacobi quartics). Thus,
instead of using a Legendre symbol, we can employ a much cheaper &quot;sign&quot;
convention (typically, the least significant bit of the representation
of a field element as an integer) to unambiguously encode and decode a
group element.</p>
<p>Unfortunately, this new encoding scheme implies an incompatible change
in the encoding format; we thus define the new groups <strong>jq255e</strong> and
<strong>jq255s</strong>, which are (algebraically) the same groups as do255e
and do255s, but with a modified encoding format. In a nutshell:</p>
<ul>
<li>
<p>To encode a point \(P = (e,u)\), first select either \(P\)
or \(P+N = (-e,-u)\), depending on the &quot;sign&quot; of \(e\); i.e.
we choose the representant of the group element whose \(e\)
coordinate is non-negative. We then encode its \(u\) coordinate
into bytes.</p>
</li>
<li>
<p>To decode a point from its \(u\) coordinate, we compute \(e^2\)
from the curve equation (\(e^2 = (a^2-4b)u^4 - 2au^2 + 1\)),
then extract its square root to get \(e\). There are two solutions;
we simply choose the non-negative one.</p>
</li>
</ul>
<p>This improved encoding format has some definite advantages. We can
compare it with the compression and decompression procedures used in the
original double-odd curve specifications, as well as what is done in
twisted Edwards curves, and their cofactor-eliminated variants
Decaf/Ristretto:</p>
<ul>
<li>
<p>In double-odd Jacobi quartics, decompression only involves a square
root computation; the Legendre symbol computation is eliminated.
While the Legendre symbol can be significantly cheaper than a square
root (down to 1/6th of the cost in small microcontrollers), not
computing it at all is even cheaper. This makes decompression
as efficient as in twisted Edwards curves and Decaf/Ristretto.</p>
</li>
<li>
<p>Our new decompression method naturally yields affine \((e,u)\)
coordinates; there is no need to smuggle an extra inversion in the
modular exponentation that is at the root of the square root
computation. In that sense, it is even slightly <em>simpler</em> than
in twisted Edwards curves and Decaf/Ristretto.</p>
</li>
<li>
<p>Encoding (compression) is immediate. In practice, starting from a
point in extended coordinates, a normalization is required, which
involves an inversion in the field. This is equivalent to twisted
Edwards curves, but more efficient than Decaf/Ristretto compression,
which requires a combined inversion/square root computation. On
small microcontrollers, inversion can be quite faster than square
roots (down to 1/5th of the cost); on large systems, batch inversion
can be thoroughly optimized, while batch square root cannot.</p>
</li>
</ul>
<h2><a class="header" href="#summary" id="summary">Summary</a></h2>
<p>The introduction of the \((e,u)\) coordinates can be summarized as
follows:</p>
<ul>
<li>
<p>We get an improved decoding mechanism, which is faster, and easier
to implement.</p>
</li>
<li>
<p>We still have decently fast general point addition formulas.</p>
</li>
<li>
<p>Point doublings get faster, which improves performance.</p>
</li>
<li>
<p>Since the decoding formulas have changed, we formally get new
prime-order groups, called <em>jq255e</em> and <em>jq255s</em>.</p>
</li>
</ul>
<p>Since jq255e and jq255s are new groups, we take the opportunity to
redefine the cryptographic schemes that operate on them (signatures, key
exchange), to replace the SHAKE function with
<a href="https://www.blake2.net/">BLAKE2s</a>, which is somewhat less versatile,
but a good deal faster, especially on small 32-bit microcontrollers.
More importantly, we also make signatures smaller (48 bytes instead of
64) and, as a side effect, faster as well, as explined in the <a href="shortsig.html">Short
Signatures</a> section.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="shortsig.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="shortsig.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
