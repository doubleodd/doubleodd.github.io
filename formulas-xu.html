<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Affine and fractional (x, u) Coordinates - Double-Odd Elliptic Curves</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="front.html"><strong aria-hidden="true">1.</strong> Double-Odd Elliptic Curves</a></li><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">2.</strong> A Geometrical Introduction</a></li><li class="chapter-item expanded "><a href="formulas.html"><strong aria-hidden="true">3.</strong> Formulas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="formulas-xy.html"><strong aria-hidden="true">3.1.</strong> Affine (x, y) Coordinates</a></li><li class="chapter-item expanded "><a href="formulas-xw.html"><strong aria-hidden="true">3.2.</strong> Affine and Jacobian (x, w) Coordinates</a></li><li class="chapter-item expanded "><a href="formulas-xu.html" class="active"><strong aria-hidden="true">3.3.</strong> Affine and fractional (x, u) Coordinates</a></li><li class="chapter-item expanded "><a href="formulas-ladder.html"><strong aria-hidden="true">3.4.</strong> x-only Ladders</a></li></ol></li><li class="chapter-item expanded "><a href="curves.html"><strong aria-hidden="true">4.</strong> Curve Choices</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="params-do255e.html"><strong aria-hidden="true">4.1.</strong> do255e</a></li><li class="chapter-item expanded "><a href="params-do255s.html"><strong aria-hidden="true">4.2.</strong> do255s</a></li></ol></li><li class="chapter-item expanded "><a href="implementations.html"><strong aria-hidden="true">5.</strong> Implementations</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Double-Odd Elliptic Curves</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#affine-and-fractional-x-u-coordinates" id="affine-and-fractional-x-u-coordinates">Affine and Fractional (x, u) Coordinates</a></h1>
<p>It can be shown that a double-odd elliptic curve is birationally
equivalent to a subgroup of a twisted Edwards curve defined in a
quadratic extension \(\mathbb{F}_{q^2}\). The general point addition
formulas on that twisted Edwards curve can then be shown to be complete
as long as we work over that specific subgroup. From these formulas, we
can derive back a coordinate system on the original double-odd elliptic
curve, with only values in \(\mathbb{F}_q\), that yield complete
formulas for general point addition in the group \(\mathbb{G}\). These
are the \(x, u\) coordinates.</p>
<h2><a class="header" href="#affine-coordinates" id="affine-coordinates">Affine Coordinates</a></h2>
<p>The \(x\) coordinate is the same one as in the affine \(x, y\)
coordinates. The \(u\) coordinate is \(u = x/y\). For the
neutral \(N\), the \(u\) coordinate is set to 0. Given points
\(P_1 = (x_1, u_1)\) and \(P_2 = (x_2, u_2)\) in \(\mathbb{G}\),
their sum in the group \(P_3 = (x_3, u_3)\) can be obtained with the
following formulas:
\[\begin{eqnarray*}
x_3 &amp;=&amp; \frac{b((x_1 + x_2)(1 + a u_1 u_2) + 2 u_1 u_2 (x_1 x_2 + b))}
{(x_1 x_2 + b)(1 - a u_1 u_2) - 2b u_1 u_2 (x_1 + x_2)} \\
u_3 &amp;=&amp; \frac{-(u_1 + u_2)(x_1 x_2 - b)}
{(x_1 x_2 + b)(1 + a u_1 u_2) + 2b u_1 u_2 (x_1 + x_2)}
\end{eqnarray*}\]
These formulas are <strong>complete</strong>.</p>
<h2><a class="header" href="#fractional-coordinates" id="fractional-coordinates">Fractional Coordinates</a></h2>
<p>In order to perform group operations efficiently, we use a fractional
representation of the \((x, u)\) coordinates. Namely, a point
\((x, u)\) is represented by the quadruplet \((X{:}Z{:}U{:}T)\)
with \(ZT \neq 0\), and such that \(x = X/Z\) and \(u = U/T\).</p>
<p>Since \(u = 1/w\), decoding of a point from its external
representation (encoding of the value \(w\)) into fractional \((x,
u)\) is done in the same way as in \((x, w)\) coordinates; when
\(x\) and \(w\) have been obtained, the fractional coordinates are
set to \((x{:}1{:}1{:}w)\) (with only a special treatment for the case
of the neutral \(N\)).</p>
<p>The addition of \(P_1 = (X_1{:}Z_1{:}U_1{:}T_1)\) with \(P_2 =
(X_2{:}Z_2{:}U_2{:}T_2)\) into \(P_3 = (X_3{:}Z_3{:}U_3{:}T_3)\) is
obtained with the following addition formulas:
\[\begin{eqnarray*}
X_3 &amp;=&amp; b((X_1 Z_2 + X_2 Z_1)(T_1 T_2 + a U_1 U_2) + 2 U_1 U_2 (X_1 X_2 + b Z_1 Z_2)) \\
Z_3 &amp;=&amp; (X_1 X_2 + b Z_1 Z_2)(T_1 T_2 - a U_1 U_2) - 2b U_1 U_2 (X_1 Z_2 + X_2 Z_1) \\
U_3 &amp;=&amp; -(U_1 T_2 + U_2 T_1)(X_1 X_2 - b Z_1 Z_2) \\
T_3 &amp;=&amp; (X_1 X_2 + b Z_1 Z_2)(T_1 T_2 + a U_1 U_2) + 2b U_1 U_2 (X_1 Z_2 + X_2 Z_1)
\end{eqnarray*}\]
Like their affine counterparts, these formulas are complete.</p>
<p>They can be implemented in cost 10M by using the following algorithm,
with the help of two precomputed constants \(\alpha =
(4b-a^2)/(2b-a)\) and \(\beta = (a-2)/(2b-a)\):</p>
<ol>
<li>\(t_1 \leftarrow X_1 X_2\)</li>
<li>\(t_2 \leftarrow Z_1 Z_2\)</li>
<li>\(t_3 \leftarrow U_1 U_2\)</li>
<li>\(t_4 \leftarrow T_1 T_2\)</li>
<li>\(t_5 \leftarrow (X_1+Z_1)(X_2+Z_2) - t_1 - t_2\)</li>
<li>\(t_6 \leftarrow (U_1+T_1)(U_2+T_2) - t_3 - t_4\)</li>
<li>\(t_7 \leftarrow t_1 + b t_2\)</li>
<li>\(t_8 \leftarrow t_4 t_7\)</li>
<li>\(t_9 \leftarrow t_3 (2bt_5 + at_7)\)</li>
<li>\(t_{10} \leftarrow (t_4 + \alpha t_3)(t_5 + t_7)\)</li>
<li>\(X_3 \leftarrow b(t_{10} - t_8 + \beta t_9)\)</li>
<li>\(Z_3 \leftarrow t_8 - t_9\)</li>
<li>\(U_3 \leftarrow -t_6(t_1 - bt_2)\)</li>
<li>\(T_3 \leftarrow t_8 + t_9\)</li>
</ol>
<p>The cost of 10M assumes that multiplication by constants \(a\),
\(b\), \(\alpha\) and \(\beta\) is inexpensive, i.e. that these
are all small integers or easily computed fractions such as \(1/2\).
Also, \(\alpha\) and \(\beta\) are not defined in \(a = 2b\); in
such a case, the implementation can still use the algorithm above by
working on an isomorphic curve where \(a \neq 2b\). Indeed, the
transform \((x, u) \mapsto (2x, u/2)\) is an easily computable
isomorphism from \(E(a, b)\) into \(E(4a, 16b)\), which side-steps
the issue.</p>
<p>For point doublings, applying the general algorithm leads to a cost
of 4M+6S (the first six multiplications are squarings in that case).
However, we can do better, with cost 3M+6S. If the source point
is \((X{:}Z{:}U{:}T)\), then we can compute its double in the
group \((X''{:}Z''{:}U''{:}T'')\) as follows:
\[\begin{eqnarray*}
X' &amp;=&amp; (a^2-4b) XZ \\
Z' &amp;=&amp; X^2 + aXZ + bZ^2 \\
X'' &amp;=&amp; 4b X'Z' \\
Z'' &amp;=&amp; X'^2 - 2a X'Z' + (a^2-4b) Z'^2 \\
U'' &amp;=&amp; 2(a^2 - 4b) (X^2 - bZ^2) Z'U \\
T'' &amp;=&amp; (X'^2 - (a^2 - 4b)Z'^2) T
\end{eqnarray*}\]
These formulas, internally, apply the \(\theta_1\) isogeny, then
\(\theta_{1/2}\); together, these two isogenies compute a point
doubling in \(\mathbb{G}\).</p>
<p>As with Jacobian coordinates, sequences of successive doublings allow
for extra optimizations. In fractional \((x, u)\) coordinates, we can
apply the \(\psi_1\) isogeny in cost 4M+2S, with an output in Jacobian
\((x, w)\) coordinates. We can then apply the \(\psi\) and
\(\theta\) isogenies repeatedly, to achieve the same marginal
per-doubling costs as in Jacobian \((x, w)\) coordinates. The final
isogeny can be modified to produce an output back in fractional
\((x, u)\) coordinates with very low overhead (at worst one extra
squaring). This leads to the following costs for \(n\) successive
doublings:</p>
<ul>
<li>\(n\)(2M+5S)+2M+1S (for all curves)</li>
<li>\(n\)(1M+6S)+4M-1S (if \(q = 3\bmod 4\))</li>
<li>\(n\)(4M+2S)+2M+2S (if \(q = 3\) or \(5\bmod 8\))</li>
<li>\(n\)(1M+5S)+3M (if \(a = 0\))</li>
<li>\(n\)(2M+4S)+2M+2S (if \(a = -1\) and \(b = 1/2\))</li>
</ul>
<p>The per-sequence overheads are higher than with Jacobian \((x, w)\)
coordinates; thus, it is beneficial to organize operations such that
doublings are always performed in long sequences.</p>
<p>Please refer to <a href="doubleodd.pdf">the whitepaper</a> (section 4.2) for
additional details on these formulas.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="formulas-xw.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="formulas-ladder.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="formulas-xw.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="formulas-ladder.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
